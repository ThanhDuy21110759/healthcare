# üì¶ Warehouse Receipt Feature ‚Äî Database Specification

## 1. Overview

This document describes the database schema for the warehouse import (receiving) feature, including:

- Warehouse receipt (header)
- Receipt items (medicine / product details)
- Relationship model

This structure follows a standard SQL relational model.

---

## 2. Database Schema

### 2.1 Table: `warehouse_receipt`

Stores warehouse import receipts.

```sql
CREATE TABLE warehouse_receipt (
    receipt_id BIGSERIAL PRIMARY KEY,
    auto_code VARCHAR(50),
    invoice_number VARCHAR(50),
    receipt_type VARCHAR(255),
    stock_keeper VARCHAR(100),
    warehouse_code VARCHAR(100),
    supplier_id BIGINT,
    debt_amount DECIMAL(18,2),

    receipt_date DATE NOT NULL,
    invoice_date DATE,
    note TEXT,

    transport_method VARCHAR(255),
    transport_unit VARCHAR(255),
    deliverer VARCHAR(255),
    vat_rate DECIMAL(5,2),

    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### Field description

| Column           | Description              | M√¥ t·∫£ ti·∫øng Vi·ªát       |
| ---------------- | ------------------------ | ---------------------- |
| receipt_id       | Primary key              | M√£ phi·∫øu nh·∫≠p (PK)     |
| auto_code        | Receipt code (generated) | M√£ phi·∫øu               |
| invoice_number   | Supplier invoice number  | S·ªë h√≥a ƒë∆°n             |
| receipt_type     | Type of receipt          | Lo·∫°i phi·∫øu nh·∫≠p        |
| stock_keeper     | Warehouse keeper         | Th·ªß kho nh·∫≠p           |
| warehouse_code   | Target warehouse         | Kho nh·∫≠p               |
| supplier_id      | Foreign key to supplier  | M√£ nh√† cung c·∫•p        |
| debt_amount      | Amount owed              | C√¥ng n·ª£                |
| receipt_date     | Date of receipt          | Ng√†y nh·∫≠p              |
| invoice_date     | Invoice date             | Ng√†y h√≥a ƒë∆°n           |
| note             | Additional comments      | Ghi ch√∫                |
| transport_method | Transport type           | Ph∆∞∆°ng ti·ªán v·∫≠n chuy·ªÉn |
| transport_unit   | Logistic carrier         | ƒê∆°n v·ªã v·∫≠n chuy·ªÉn      |
| deliverer        | Person delivering goods  | Ng∆∞·ªùi giao h√†ng        |
| vat_rate         | VAT applied              | VAT (%)                |
| created_at       | Timestamp creation       | Ng√†y t·∫°o               |
| updated_at       | Timestamp update         | Ng√†y c·∫≠p nh·∫≠t          |

---

### 2.2 Table: `warehouse_receipt_item`

Stores individual items inside a receipt.

```sql
CREATE TABLE warehouse_receipt_item (
    item_id BIGSERIAL PRIMARY KEY,
    receipt_id BIGINT NOT NULL REFERENCES warehouse_receipt(receipt_id),

    product_code VARCHAR(100),
    product_name VARCHAR(255),
    registration_number VARCHAR(100),
    active_ingredient VARCHAR(255),
    declared_active_ingredient VARCHAR(255),
    concentration VARCHAR(100),
    packing VARCHAR(255),
    manufacturer VARCHAR(255),
    origin_country VARCHAR(255),
    allow_interconnect BOOLEAN,

    product_group VARCHAR(255),
    import_quantity INT,
    lot_number VARCHAR(100),
    expiration_date DATE,
    location VARCHAR(255),

    import_unit VARCHAR(100),
    conversion_rate DECIMAL(10,2),
    item_vat_rate DECIMAL(5,2),
    import_price DECIMAL(18,2),
    selling_price DECIMAL(18,2),
    keywords TEXT,

    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### Field description

| Column                     | Description                    | M√¥ t·∫£ ti·∫øng Vi·ªát         |
| -------------------------- | ------------------------------ | ------------------------ |
| receipt_id                 | FK to `warehouse_receipt`      | M√£ phi·∫øu nh·∫≠p            |
| product_code               | Standardized product ID        | M√£ ƒêQG / M√£ h√†ng h√≥a     |
| product_name               | Name of product / medicine     | T√™n h√†ng h√≥a / t√™n thu·ªëc |
| registration_number        | Registration / approval number | S·ªë ƒëƒÉng k√Ω               |
| active_ingredient          | Main active ingredient         | Ho·∫°t ch·∫•t ch√≠nh          |
| declared_active_ingredient | Declared ingredient            | Ho·∫°t ch·∫•t ƒëƒÉng k√Ω        |
| concentration              | Concentration value            | H√†m l∆∞·ª£ng                |
| packing                    | Packaging format               | Quy c√°ch ƒë√≥ng g√≥i        |
| manufacturer               | Manufacturer                   | H√£ng s·∫£n xu·∫•t            |
| origin_country             | Country of origin              | N∆∞·ªõc s·∫£n xu·∫•t            |
| allow_interconnect         | Boolean linking allowed        | Cho ph√©p li√™n th√¥ng      |
| product_group              | Product category               | Nh√≥m h√†ng h√≥a            |
| import_quantity            | Quantity imported              | S·ªë l∆∞·ª£ng nh·∫≠p            |
| lot_number                 | Production lot                 | S·ªë l√¥                    |
| expiration_date            | Expiry date                    | H·∫°n s·ª≠ d·ª•ng              |
| location                   | Warehouse placement            | V·ªã tr√≠ trong kho         |
| import_unit                | Packaging unit                 | ƒê∆°n v·ªã nh·∫≠p              |
| conversion_rate            | Unit conversion ratio          | T·ª∑ l·ªá quy ƒë·ªïi            |
| item_vat_rate              | VAT applied                    | VAT (%)                  |
| import_price               | Purchase price                 | Gi√° nh·∫≠p                 |
| selling_price              | Suggested retail price         | Gi√° b√°n                  |
| keywords                   | Search keywords                | T·ª´ kh√≥a                  |

---

## 3. Relationship Model

```
warehouse_receipt (1) ‚îÄ‚îÄ‚îÄ (N) warehouse_receipt_item
```

- One receipt contains multiple item entries.
- Items cannot exist without a receipt.

---

## 4. Example Insert Queries

### 4.1 Insert into `warehouse_receipt`

```sql
INSERT INTO warehouse_receipt (
    auto_code,
    invoice_number,
    receipt_type,
    stock_keeper,
    warehouse_code,
    supplier_id,
    debt_amount,
    receipt_date,
    invoice_date,
    note,
    transport_method,
    transport_unit,
    deliverer,
    vat_rate
)
VALUES (
    'PNK-2025-0001',
    'HD-001',
    'Nh·∫≠p kho t·ª´ danh m·ª•c',
    'V√µ Tr∆∞·ªùng S∆°n',
    'TN999',
    123,
    0,
    '2025-01-10',
    NULL,
    'Nh·∫≠p thu·ªëc m·ªõi',
    'Xe m√°y',
    'Grab',
    'Nguy·ªÖn VƒÉn A',
    5.0
);
```

---

### 4.2 Insert into `warehouse_receipt_item`

```sql
INSERT INTO warehouse_receipt_item (
    receipt_id,
    product_code,
    product_name,
    import_quantity,
    lot_number,
    expiration_date,
    import_unit,
    conversion_rate,
    import_price,
    selling_price
)
VALUES (
    1,
    'DQG00034598',
    'Chorsamine-20',
    10,
    '233232',
    '2022-02-22',
    'H·ªôp',
    30,
    30000,
    35000
);
```

---

### 4.3 Insert into `warehouse_receipt_item` (Autonomous Import)

_Allow inserting items without a corresponding receipt._

```sql
INSERT INTO warehouse_receipt_item (
    product_code,
    import_unit,
    product_name,
    product_group,
    import_quantity,
    import_price,
    selling_price,
    item_vat_rate,
    expiration_date,
    keywords
)
VALUES (
    'DQG00098765',
    'H·ªôp',
    'Paracetamol 500mg',
    'Thu·ªëc gi·∫£m ƒëau',
    50,
    12000,
    15000,
    5.0,
    '2026-12-31',
    'paracetamol; gi·∫£m ƒëau; h·∫° s·ªët'
);
```

---

## 5. Versioning

| Version | Date       | Changes                                  |
| ------- | ---------- | ---------------------------------------- |
| 1.0     | 16/11/2025 | Base schema definition                   |
| 2.0     | 5/12/2025  | Insert autonomous import without receipt |
